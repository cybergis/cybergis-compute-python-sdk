<!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml"> <meta charset=utf-8  /> <meta name=viewport  content="width=device-width,initial-scale=1"> <meta http-equiv=x-ua-compatible  content="ie=edge"> <meta name="lang:clipboard.copy" content="Copy to clipboard"> <meta name="lang:clipboard.copied" content="Copied to clipboard"> <meta name="lang:search.language" content=en > <meta name="lang:search.pipeline.stopwords" content=True > <meta name="lang:search.pipeline.trimmer" content=True > <meta name="lang:search.result.none" content="No matching documents"> <meta name="lang:search.result.one" content="1 matching document"> <meta name="lang:search.result.other" content="# matching documents"> <meta name="lang:search.tokenizer" content="[\s\-]+"> <link href="https://fonts.gstatic.com/" rel=preconnect  crossorigin> <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel=stylesheet > <style> body, input { font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif } code, kbd, pre { font-family: "Roboto Mono", "Courier New", Courier, monospace } </style> <link rel=stylesheet  href="../_static/stylesheets/application.css"/> <link rel=stylesheet  href="../_static/stylesheets/application-palette.css"/> <link rel=stylesheet  href="../_static/stylesheets/application-fixes.css"/> <link rel=stylesheet  href="../_static/fonts/material-icons.css"/> <meta name=theme-color  content="#3f51b5"> <script src="../_static/javascripts/modernizr.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-L30GKBCQYB"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-L30GKBCQYB'); </script> <title>Developing a Model with CyberGIS-Compute &#8212; CyberGIS-Compute Python SDK v0.2.5 documentation</title> <link rel=stylesheet  href="../_static/material.css" type="text/css" /> <link rel=stylesheet  href="../_static/pygments.css" type="text/css" /> <script id=documentation_options  data-url_root="../" src="../_static/documentation_options.js"></script> <script src="../_static/jquery.js"></script> <script src="../_static/underscore.js"></script> <script src="../_static/doctools.js"></script> <script src="../_static/language_data.js"></script> <script crossorigin=anonymous  integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script> <script async=async  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script> <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "tex2jax_ignore|mathjax_ignore|document", "processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script> <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script> <link rel="shortcut icon" href="../_static/favico.ico"/> <link rel=author  title="About these documents" href="../about.html" /> <link rel=index  title=Index  href="../genindex.html" /> <link rel=search  title=Search  href="../search.html" /> <link rel=next  title="Frequently Asked Questions" href=faq.html  /> <link rel=prev  title="Contributing Models" href=index.html  /> <body dir=ltr data-md-color-primary=dark-blue data-md-color-accent=orange> <svg class=md-svg > <defs data-children-count=0 > <svg xmlns="http://www.w3.org/2000/svg" width=416  height=448  viewBox="0 0 416 448" id=__github ><path fill=currentColor  d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle  data-md-toggle=drawer  type=checkbox  id=__drawer > <input class=md-toggle  data-md-toggle=search  type=checkbox  id=__search > <label class=md-overlay  data-md-component=overlay  for=__drawer ></label> <a href="#model_contribution/develop_model" tabindex=1  class=md-skip > Skip to content </a> <header class=md-header  data-md-component=header > <nav class="md-header-nav md-grid"> <div class="md-flex navheader"> <div class="md-flex__cell md-flex__cell--shrink"> <a href="../index.html" title="CyberGIS-Compute Python SDK v0.2.5 documentation" class="md-header-nav__button md-logo"> <img src="../_static/favico.ico" height=26  alt="CyberGIS-Compute Python SDK v0.2.5 documentation logo"> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer ></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title > <span class=md-header-nav__topic >CyberGIS-Compute Python SDK</span> <span class=md-header-nav__topic > Developing a Model with CyberGIS-Compute </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search ></label> <div class=md-search  data-md-component=search  role=dialog > <label class=md-search__overlay  for=__search ></label> <div class=md-search__inner  role=search > <form class=md-search__form  action="../search.html" method=get  name=search > <input type=text  class=md-search__input  name=q  placeholder=""Search"" autocapitalize=off  autocomplete=off  spellcheck=false  data-md-component=query  data-md-state=active > <label class="md-icon md-search__icon" for=__search ></label> <button type=reset  class="md-icon md-search__icon" data-md-component=reset  tabindex=-1 > &#xE5CD; </button> </form> <div class=md-search__output > <div class=md-search__scrollwrap  data-md-scrollfix> <div class=md-search-result  data-md-component=result > <div class=md-search-result__meta > Type to start searching </div> <ol class=md-search-result__list ></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source > <a href="https://github.com/cybergis/cybergis-compute-python-sdk" title="Go to repository" class=md-source  data-md-source=github > <div class=md-source__icon > <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width=28  height=28 > <use xlink:href="#__github" width=24  height=24 ></use> </svg> </div> <div class=md-source__repository > cybergis-compute-python-sdk </div> </a> </div> </div> <script src="../_static/javascripts/version_dropdown.js"></script> <script> var json_loc = "../"versions.json"", target_loc = "../../", text = "Versions"; $( document ).ready( add_version_dropdown(json_loc, target_loc, text)); </script> </div> </nav> </header> <div class=md-container > <nav class=md-tabs  data-md-component=tabs > <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list > <li class=md-tabs__item ><a href="../index.html" class=md-tabs__link >CyberGIS-Compute Python SDK v0.2.5 documentation</a> <li class=md-tabs__item ><a href=index.html  class=md-tabs__link >Contributing Models</a> </ul> </div> </nav> <main class=md-main > <div class="md-main__inner md-grid" data-md-component=container > <div class="md-sidebar md-sidebar--primary" data-md-component=navigation > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--primary" data-md-level=0 > <label class="md-nav__title md-nav__title--site" for=__drawer > <a href="../index.html" title="CyberGIS-Compute Python SDK v0.2.5 documentation" class="md-nav__button md-logo"> <img src="../_static/favico.ico" alt=" logo" width=48  height=48 > </a> <a href="../index.html" title="CyberGIS-Compute Python SDK v0.2.5 documentation">CyberGIS-Compute Python SDK</a> </label> <div class=md-nav__source > <a href="https://github.com/cybergis/cybergis-compute-python-sdk" title="Go to repository" class=md-source  data-md-source=github > <div class=md-source__icon > <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width=28  height=28 > <use xlink:href="#__github" width=24  height=24 ></use> </svg> </div> <div class=md-source__repository > cybergis-compute-python-sdk </div> </a> </div> <ul class=md-nav__list > <li class=md-nav__item > <a href="../about.html" class=md-nav__link >About</a> <li class=md-nav__item > <a href="../usage.html" class=md-nav__link >Using CyberGIS-Compute</a> <li class=md-nav__item > <a href="../notebooks/hello_world.html" class=md-nav__link >Hello World Notebook</a> <li class=md-nav__item > <a href="../models.html" class=md-nav__link >Model Gallery</a> <li class=md-nav__item > <a href="../release-notes.html" class=md-nav__link >Release Notes</a> <li class=md-nav__item > <a href="../external.html" class=md-nav__link >Related Projects</a> <li class=md-nav__item > <a href="../help.html" class=md-nav__link >Getting Help</a> <li class=md-nav__item > <a href=index.html  class=md-nav__link >Contributing Models</a> <ul class=md-nav__list > <li class=md-nav__item > <input class="md-toggle md-nav__toggle" data-md-toggle=toc  type=checkbox  id=__toc > <label class="md-nav__link md-nav__link--active" for=__toc > Developing a Model with CyberGIS-Compute </label> <a href="#" class="md-nav__link md-nav__link--active">Developing a Model with CyberGIS-Compute</a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title  for=__toc >"Contents"</label> <ul class=md-nav__list  data-md-scrollfix=""> <li class=md-nav__item ><a href="#model-contribution-develop-model--page-root" class=md-nav__link >Developing a Model with CyberGIS-Compute</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#what-are-the-stages-of-your-model" class=md-nav__link >What are the stages of your model?</a> <li class=md-nav__item ><a href="#notebook-to-script-nbconvert" class=md-nav__link >Notebook to Script/Nbconvert</a> <li class=md-nav__item ><a href="#getting-results-from-compute" class=md-nav__link >Getting Results from Compute</a> <li class=md-nav__item ><a href="#crash-course-in-the-manifest" class=md-nav__link >Crash Course in the Manifest</a> <li class=md-nav__item ><a href="#crash-course-in-slurm-parameters" class=md-nav__link >Crash Course in SLURM Parameters</a> <li class=md-nav__item ><a href="#supported-hpc" class=md-nav__link >Supported HPC</a> <li class=md-nav__item ><a href="#providing-input-data" class=md-nav__link >Providing Input Data</a> <li class=md-nav__item ><a href="#installing-packages" class=md-nav__link >Installing Packages</a> <li class=md-nav__item ><a href="#contributing-your-model" class=md-nav__link >Contributing Your Model</a> <li class=md-nav__item ><a href="#advanced-topic-manifest-options" class=md-nav__link >Advanced Topic: Manifest Options</a> <li class=md-nav__item ><a href="#advanced-topic-passing-parameters" class=md-nav__link >Advanced Topic: Passing Parameters</a> <li class=md-nav__item ><a href="#advanced-topic-providing-a-container" class=md-nav__link >Advanced Topic: Providing a Container</a> <li class=md-nav__item ><a href="#advanced-topic-pre-and-post-steps" class=md-nav__link >Advanced Topic: Pre- and Post- Steps</a> </ul> </nav> <li class=md-nav__item ><a class=md-nav__extra_link  href="../_sources/model_contribution/develop_model.rst.txt">Show Source</a> </ul> </nav> <ul class=md-nav__list > <li class=md-nav__item > <a href="#what-are-the-stages-of-your-model" class=md-nav__link >What are the stages of your model?</a> <li class=md-nav__item > <a href="#notebook-to-script-nbconvert" class=md-nav__link >Notebook to Script/Nbconvert</a> <li class=md-nav__item > <a href="#getting-results-from-compute" class=md-nav__link >Getting Results from Compute</a> <li class=md-nav__item > <a href="#crash-course-in-the-manifest" class=md-nav__link >Crash Course in the Manifest</a> <li class=md-nav__item > <a href="#crash-course-in-slurm-parameters" class=md-nav__link >Crash Course in SLURM Parameters</a> <li class=md-nav__item > <a href="#supported-hpc" class=md-nav__link >Supported HPC</a> <li class=md-nav__item > <a href="#providing-input-data" class=md-nav__link >Providing Input Data</a> <li class=md-nav__item > <a href="#installing-packages" class=md-nav__link >Installing Packages</a> <li class=md-nav__item > <a href="#contributing-your-model" class=md-nav__link >Contributing Your Model</a> <li class=md-nav__item > <a href="#advanced-topic-manifest-options" class=md-nav__link >Advanced Topic: Manifest Options</a> <li class=md-nav__item > <a href="#advanced-topic-passing-parameters" class=md-nav__link >Advanced Topic: Passing Parameters</a> <li class=md-nav__item > <a href="#advanced-topic-providing-a-container" class=md-nav__link >Advanced Topic: Providing a Container</a> <li class=md-nav__item > <a href="#advanced-topic-pre-and-post-steps" class=md-nav__link >Advanced Topic: Pre- and Post- Steps</a> </ul> <li class=md-nav__item > <a href=faq.html  class=md-nav__link >Frequently Asked Questions</a> </ul> <li class=md-nav__item > <a href="../reference.html" class=md-nav__link >Developer Documentation</a> <li class=md-nav__item > <a href="../contributing.html" class=md-nav__link >Contributing to CyberGIS-Compute</a> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc > <div class=md-sidebar__scrollwrap > <div class=md-sidebar__inner > <nav class="md-nav md-nav--secondary"> <label class=md-nav__title  for=__toc >"Contents"</label> <ul class=md-nav__list  data-md-scrollfix=""> <li class=md-nav__item ><a href="#model-contribution-develop-model--page-root" class=md-nav__link >Developing a Model with CyberGIS-Compute</a><nav class=md-nav > <ul class=md-nav__list > <li class=md-nav__item ><a href="#what-are-the-stages-of-your-model" class=md-nav__link >What are the stages of your model?</a> <li class=md-nav__item ><a href="#notebook-to-script-nbconvert" class=md-nav__link >Notebook to Script/Nbconvert</a> <li class=md-nav__item ><a href="#getting-results-from-compute" class=md-nav__link >Getting Results from Compute</a> <li class=md-nav__item ><a href="#crash-course-in-the-manifest" class=md-nav__link >Crash Course in the Manifest</a> <li class=md-nav__item ><a href="#crash-course-in-slurm-parameters" class=md-nav__link >Crash Course in SLURM Parameters</a> <li class=md-nav__item ><a href="#supported-hpc" class=md-nav__link >Supported HPC</a> <li class=md-nav__item ><a href="#providing-input-data" class=md-nav__link >Providing Input Data</a> <li class=md-nav__item ><a href="#installing-packages" class=md-nav__link >Installing Packages</a> <li class=md-nav__item ><a href="#contributing-your-model" class=md-nav__link >Contributing Your Model</a> <li class=md-nav__item ><a href="#advanced-topic-manifest-options" class=md-nav__link >Advanced Topic: Manifest Options</a> <li class=md-nav__item ><a href="#advanced-topic-passing-parameters" class=md-nav__link >Advanced Topic: Passing Parameters</a> <li class=md-nav__item ><a href="#advanced-topic-providing-a-container" class=md-nav__link >Advanced Topic: Providing a Container</a> <li class=md-nav__item ><a href="#advanced-topic-pre-and-post-steps" class=md-nav__link >Advanced Topic: Pre- and Post- Steps</a> </ul> </nav> <li class=md-nav__item ><a class=md-nav__extra_link  href="../_sources/model_contribution/develop_model.rst.txt">Show Source</a> <li id=searchbox  class=md-nav__item > </ul> </nav> </div> </div> </div> <div class=md-content > <article class="md-content__inner md-typeset" role=main > <h1 id=model-contribution-develop-model--page-root >Developing a Model with CyberGIS-Compute<a class=headerlink  href="#model-contribution-develop-model--page-root" title="Permalink to this headline">¶</a></h1> <p>This section walks you through converting a Jupyter notebook to a model for CyberGIS-Compute. The examples use Python for simplicity, but Compute supports arbitrary software and languages.</p> <div class="admonition tip"> <p class=admonition-title >Tip</p> <p>If you haven’t already, we highly recommend starting with the notebooks in the Pysal Access Compute Example (specifically <a class="reference external" href="https://github.com/cybergis/pysal-access-compute-example/blob/main/IntroToCyberGIS-Compute.ipynb">IntroToCyberGIS-Compute.ipynb</a> and <a class="reference external" href="https://github.com/cybergis/pysal-access-compute-example/blob/main/ContributingAModel.ipynb">ContributingAModel.ipynb</a>) which are available:</p> <ul class=simple > <li><p>On CyberGISX Hub: <a class="reference external" href="https://cybergisxhub.cigi.illinois.edu/notebook/pysal-access-compute-example/">https://cybergisxhub.cigi.illinois.edu/notebook/pysal-access-compute-example/</a></p> <li><p>On Github: <a class="reference external" href="https://github.com/cybergis/pysal-access-compute-example">https://github.com/cybergis/pysal-access-compute-example</a></p> </ul> <p>The <a class="reference external" href="https://github.com/cybergis/cybergis-compute-examples">CyberGIS-Compute-Examples</a> repository also has a guided walkthrough for creating a CyberGIS-Compute model with three simple examples.</p> <p>We recommend these notebooks first to get some hands-on experience with CyberGIS-Compute before diving into making your own model!</p> </div> <h2 id=what-are-the-stages-of-your-model >What are the stages of your model?<a class=headerlink  href="#what-are-the-stages-of-your-model" title="Permalink to this headline">¶</a></h2> <p>First, ask yourself, what are the different steps/stages of my model? CyberGIS-Compute offers flexibility by providing a pre processing stage, executation stage, and post-processing stage. Some examples of how you can use those stages are:</p> <ul class=simple > <li><p>[Pre] Install packages with Pip –&gt; [Main] Run a model in Python (this model!)</p> <li><p>[Pre] Compile code –&gt; [Main] Run the model –&gt; [Post] Manage/analyze the model outputs</p> <li><p>[Pre] Download data –&gt; [Main] Analyze the data</p> </ul> <p>It is best to have each stage contained within a single script/line (i.e. <code class="docutils literal notranslate"><span class=pre >python</span> <span class=pre >my_model.py</span></code> or <code class="docutils literal notranslate"><span class=pre >bash</span> <span class=pre >run_the_model.sh</span></code>) for simplicity.</p> <h2 id=notebook-to-script-nbconvert >Notebook to Script/Nbconvert<a class=headerlink  href="#notebook-to-script-nbconvert" title="Permalink to this headline">¶</a></h2> <p>If you already have your code as a script that can run, this part is mostly done! If you have it as a Jupyter notebook, this section talks about converting that to an executable script.</p> <p>You can use nbconvert to convert your notebook to a script. Note that any lines with bash (“!&lt;bash command&gt;”) and ipywidgets won’t run correctly as a script. The command line syntax (docs here: <a class="reference external" href="https://nbconvert.readthedocs.io/en/latest/usage.html">https://nbconvert.readthedocs.io/en/latest/usage.html</a>) for nbconvert looks like:</p> <div class="highlight-default notranslate"><div class=highlight ><pre><span></span><span class=n >jupyter</span> <span class=n >nbconvert</span> <span class=o >--</span><span class=n >to</span> <span class=n >FORMAT</span> <span class=n >notebook</span><span class=o >.</span><span class=n >ipynb</span>
</pre></div> </div> <p>Alternatively you can do this in Jupyterlab. Open the notebook, go to “File”, then “Save and Export Notebook As…”, then select “Executable Script.” This will allow you to download the notebook as a .py Python script.</p> <div class="figure align-default" id=id1 > <a class="reference internal image-reference" href="../_images/JupyterExportAs.png"><img alt="A screenshot of the JupyterLab interface exporting a notebook." src="../_images/JupyterExportAs.png" style="width: 432.75px; height: 655.5px;"/></a> <p class=caption ><span class=caption-text >A screenshot of the JupyterLab interface exporting a notebook.</span><a class=headerlink  href="#id1" title="Permalink to this image">¶</a></p> </div> <p>To test your script, you can run it in the command line with:</p> <div class="highlight-default notranslate"><div class=highlight ><pre><span></span><span class=n >python</span> <span class=o >&lt;</span><span class=n >your</span> <span class=n >script</span><span class=o >&gt;.</span><span class=n >py</span>
</pre></div> </div> <p>Note that your python environment will need all of the necessary packages to fully run the program.</p> <h2 id=getting-results-from-compute >Getting Results from Compute<a class=headerlink  href="#getting-results-from-compute" title="Permalink to this headline">¶</a></h2> <p>For simple output, you can use the SLURM logs. If you print the necessary output information in your script, it will be displayed in the job’s SLURM logs.</p> <p>These logs will be saved in the output folder that you can download with the UI. When you download this folder after your job runs, there will be a subfolder titled slurm_logs. In that folder, there will be a job.stdout file with the SLURM logs in it.</p> <div class="figure align-default" id=id2 > <a class="reference internal image-reference" href="../_images/DownloadJobOutput.png"><img alt='A screenshot of the "Download Job Results" tab in the Compute UI.' src="../_images/DownloadJobOutput.png" style="width: 442.5px; height: 174.0px;"/></a> <p class=caption ><span class=caption-text >A screenshot of the “Download Job Results” tab in the Compute UI.</span><a class=headerlink  href="#id2" title="Permalink to this image">¶</a></p> </div> <p>For more involved output, it is best to save information to the result_folder. You can get the path to this with the “result_folder” environment variable (os.environ[“result_folder”] in Python). Any files saved here can be downloaded from the UI after your job runs.</p> <h2 id=crash-course-in-the-manifest >Crash Course in the Manifest<a class=headerlink  href="#crash-course-in-the-manifest" title="Permalink to this headline">¶</a></h2> <p>This section walks through the basics of how to set up a manifest that runs this script as a main step. More complex workflows are supported (pre- and post-processing stages), but many times the work can be compiled into a singular script to run.</p> <p>As a first step, you must create a manifest.json file that just runs your script. To start, add a manifest.json file to your repository. For a very basic project, you will need name, container, execution_stage, slurm_input_rules, and require_upload_data as fields. Here is an overview of what the different fields mean and the information each should contain:</p> <ul class=simple > <li><p><strong>name:</strong> The name of your model.</p> <li><p><strong>container:</strong> The container environment to run your code on. We recommend “python” or “cybergisx-0.4” as a default.</p> <li><p><strong>execution_stage:</strong> The bash command that runs when the project begins. In this case, we are just running whatever your script is, so “python &lt;your script&gt;.py” will be sufficient.</p> <li><p><strong>slurm_input_rules:</strong> The HPC resources being used. This usually defines the max and min, but you will be able to adjust this when submitting individual jobs in the section of dropdowns before you submit. In this example, there is time, the runtime limit, num_of_task, the number of times your task will run, and memory_per_cpu, the amount of memory per CPU.</p> <li><p><strong>require_upload_data:</strong> Whether or not your project requires users to upload data</p> </ul> <p>An example manifest from the <a class="reference external" href="https://github.com/cybergis/pysal-access-compute-example">Pysal Access Compute Example model</a> can be seen below:</p> <div class="highlight-default notranslate"><div class=highlight ><pre><span></span><span class=p >{</span>
    <span class=s2 >"name"</span><span class=p >:</span> <span class=s2 >"Pysal Access Example"</span><span class=p >,</span>
    <span class=s2 >"container"</span><span class=p >:</span> <span class=s2 >"cybergisx-0.4"</span><span class=p >,</span>
    <span class=s2 >"pre_processing_stage"</span><span class=p >:</span> <span class=s2 >"bash install_access.sh"</span><span class=p >,</span>
    <span class=s2 >"execution_stage"</span><span class=p >:</span> <span class=s2 >"python ChicagoAccess.py"</span><span class=p >,</span>
    <span class=s2 >"post_processing_stage"</span><span class=p >:</span> <span class=s2 >"ls"</span><span class=p >,</span>
    <span class=s2 >"slurm_input_rules"</span><span class=p >:</span> <span class=p >{</span>
        <span class=s2 >"time"</span><span class=p >:</span> <span class=p >{</span>
                <span class=s2 >"max"</span><span class=p >:</span> <span class=mi >30</span><span class=p >,</span>
                <span class=s2 >"min"</span><span class=p >:</span> <span class=mi >15</span><span class=p >,</span>
                <span class=s2 >"default_value"</span><span class=p >:</span> <span class=mi >20</span><span class=p >,</span>
                <span class=s2 >"step"</span><span class=p >:</span> <span class=mi >1</span><span class=p >,</span>
                <span class=s2 >"unit"</span><span class=p >:</span> <span class=s2 >"Minutes"</span>
            <span class=p >},</span>
            <span class=s2 >"memory"</span><span class=p >:</span> <span class=p >{</span>
                <span class=s2 >"max"</span><span class=p >:</span> <span class=mi >4</span><span class=p >,</span>
                <span class=s2 >"min"</span><span class=p >:</span> <span class=mi >2</span><span class=p >,</span>
                <span class=s2 >"default_value"</span><span class=p >:</span> <span class=mi >4</span><span class=p >,</span>
                <span class=s2 >"step"</span><span class=p >:</span> <span class=mi >1</span><span class=p >,</span>
                <span class=s2 >"unit"</span><span class=p >:</span> <span class=s2 >"GB"</span>
            <span class=p >}</span>
    <span class=p >},</span>
    <span class=s2 >"require_upload_data"</span><span class=p >:</span> <span class=n >false</span>
<span class=p >}</span>
</pre></div> </div> <p>For more information see <a class="reference internal" href="#advanced-topic-manifest-options">Advanced Topic: Manifest Options</a>.</p> <h2 id=crash-course-in-slurm-parameters >Crash Course in SLURM Parameters<a class=headerlink  href="#crash-course-in-slurm-parameters" title="Permalink to this headline">¶</a></h2> <p>Slurm parameters can be added by adding a “slurm_input_rules” to the manifest.json file. These will then be rendered in the UI when model users submit a job. In the manifest crash course, you set three parameters, the time, num_of_task, and memory_per_cpu. There are a lot more that can be added. Here is a list of supported inputs and what they represent:</p> <ul class=simple > <li><p><strong>num_of_node (integerRule):</strong> The number of nodes allocated to this job.</p> <li><p><strong>num_of_task (integerRule):</strong> The number of tasks.</p> <li><p><strong>time (integerRule):</strong> The runtime limit.</p> <li><p><strong>cpu_per_task (integerRule):</strong> The job steps will require this many CPUs per task.</p> <li><p><strong>memory_per_cpu (integerRule):</strong> Minimum memory required per allocated CPU.</p> <li><p><strong>memory_per_gpu (integerRule):</strong> Minimum memory per allocated GPU.</p> <li><p><strong>memory (integerRule):</strong> Total memory allocated.</p> <li><p><strong>gpus (integerRule):</strong> The total number of GPUS required for the job.</p> <li><p><strong>gpus_per_node (integerRule):</strong> The number of GPUs required for the job on each node included in the job’s resource allocation.</p> <li><p><strong>gpus_per_socket (integerRule):</strong> The number of GPUs required for the job on each socket included in the job’s resource allocation.</p> <li><p><strong>gpus_per_task (integerRule):</strong> The number of GPUs required for the job on each task to be spawned in the job’s resource allocation.</p> <li><p><strong>partition (stringOptionRule):</strong> The partition name on the HPC.</p> </ul> <p>You can specify these SLURM parameters including a reasonable range for running your model. The UI will read from this manifest and populate widgets for users to specify SLURM settings. The widgets available for each SLURM parameter are:</p> <div class="highlight-default notranslate"><div class=highlight ><pre><span></span><span class=p >{</span>
    <span class=o >//</span> <span class=o >...</span>
    <span class=s2 >"slurm_input_rules"</span><span class=p >:</span> <span class=p >{</span>
        <span class=s2 >"num_of_node"</span><span class=p >:</span> <span class=n >integerRule</span><span class=p >,</span>     <span class=o >//</span> <span class=n >number</span> <span class=n >of</span> <span class=n >nodes</span><span class=p >,</span> <span class=n >ie</span><span class=o >.</span> <span class=n >SBATCH</span> <span class=n >nodes</span>
        <span class=s2 >"num_of_task"</span><span class=p >:</span> <span class=n >integerRule</span><span class=p >,</span>     <span class=o >//</span> <span class=n >number</span> <span class=n >of</span> <span class=n >tasks</span><span class=p >,</span> <span class=n >ie</span><span class=o >.</span> <span class=n >SBATCH</span> <span class=n >ntasks</span>
        <span class=s2 >"time"</span><span class=p >:</span> <span class=n >integerRule</span><span class=p >,</span>            <span class=o >//</span> <span class=n >runtime</span> <span class=n >limit</span><span class=p >,</span> <span class=n >ie</span><span class=o >.</span> <span class=n >SBATCH</span> <span class=n >time</span>
        <span class=s2 >"cpu_per_task"</span><span class=p >:</span> <span class=n >integerRule</span><span class=p >,</span>    <span class=o >//</span> <span class=n >number</span> <span class=n >of</span> <span class=n >CPU</span> <span class=n >per</span> <span class=n >task</span><span class=p >,</span> <span class=n >ie</span><span class=o >.</span> <span class=n >SBATCH</span> <span class=n >cpus</span><span class=o >-</span><span class=n >per</span><span class=o >-</span><span class=n >task</span>
        <span class=s2 >"memory_per_cpu"</span><span class=p >:</span> <span class=n >integerRule</span><span class=p >,</span>  <span class=o >//</span> <span class=n >amount</span> <span class=n >of</span> <span class=n >memory</span> <span class=n >per</span> <span class=n >CPU</span><span class=p >,</span> <span class=n >ie</span><span class=o >.</span> <span class=n >SBATCH</span> <span class=n >mem</span><span class=o >-</span><span class=n >per</span><span class=o >-</span><span class=n >cpu</span>
        <span class=s2 >"memory_per_gpu"</span><span class=p >:</span> <span class=n >integerRule</span><span class=p >,</span>  <span class=o >//</span> <span class=n >amount</span> <span class=n >of</span> <span class=n >memory</span> <span class=n >per</span> <span class=n >GPU</span><span class=p >,</span> <span class=n >ie</span><span class=o >.</span> <span class=n >SBATCH</span> <span class=n >mem</span><span class=o >-</span><span class=n >per</span><span class=o >-</span><span class=n >gpu</span>
        <span class=s2 >"memory"</span><span class=p >:</span> <span class=n >integerRule</span><span class=p >,</span>          <span class=o >//</span> <span class=n >total</span> <span class=n >memory</span> <span class=n >allocated</span><span class=p >,</span> <span class=n >ie</span><span class=o >.</span> <span class=n >SBATCH</span> <span class=n >mem</span>
        <span class=s2 >"gpus"</span><span class=p >:</span> <span class=n >integerRule</span><span class=p >,</span>            <span class=o >//</span> <span class=n >total</span> <span class=n >GPU</span> <span class=n >allocated</span><span class=p >,</span> <span class=n >ie</span><span class=o >.</span> <span class=n >SBATCH</span> <span class=n >gpus</span>
        <span class=s2 >"gpus_per_node"</span><span class=p >:</span> <span class=n >integerRule</span><span class=p >,</span>   <span class=o >//</span> <span class=n >number</span> <span class=n >of</span> <span class=n >GPU</span> <span class=n >per</span> <span class=n >node</span><span class=p >,</span> <span class=n >ie</span><span class=o >.</span> <span class=n >SBATCH</span> <span class=n >gpus</span><span class=o >-</span><span class=n >per</span><span class=o >-</span><span class=n >node</span>
        <span class=s2 >"gpus_per_socket"</span><span class=p >:</span> <span class=n >integerRule</span><span class=p >,</span> <span class=o >//</span> <span class=n >number</span> <span class=n >of</span> <span class=n >GPU</span> <span class=n >per</span> <span class=n >socket</span><span class=p >,</span> <span class=n >ie</span><span class=o >.</span> <span class=n >SBATCH</span> <span class=n >gpus</span><span class=o >-</span><span class=n >per</span><span class=o >-</span><span class=n >socket</span>
        <span class=s2 >"gpus_per_task"</span><span class=p >:</span> <span class=n >integerRule</span><span class=p >,</span>   <span class=o >//</span> <span class=n >number</span> <span class=n >of</span> <span class=n >GPU</span> <span class=n >per</span> <span class=n >task</span><span class=p >,</span> <span class=n >ie</span><span class=o >.</span> <span class=n >SBATCH</span> <span class=n >gpus</span><span class=o >-</span><span class=n >per</span><span class=o >-</span><span class=n >task</span>
        <span class=s2 >"partition"</span><span class=p >:</span> <span class=n >stringOptionRule</span>   <span class=o >//</span> <span class=n >partition</span> <span class=n >name</span> <span class=n >on</span> <span class=n >HPC</span><span class=p >,</span> <span class=n >ie</span><span class=o >.</span> <span class=n >SBATCH</span> <span class=n >partition</span>
    <span class=p >}</span>
<span class=p >}</span>
</pre></div> </div> <p>An example from the <a class="reference external" href="https://github.com/cybergis/cybergis-compute-v2-summa/blob/ef3c3bde53e44a85f929a023d2876c8e2e9652de/manifest.json">SUMMA CyberGIS-Compute model’s manifest</a> can be seen below:</p> <div class="highlight-default notranslate"><div class=highlight ><pre><span></span><span class=s2 >"slurm_input_rules"</span><span class=p >:</span> <span class=p >{</span>

       <span class=s2 >"time"</span><span class=p >:</span> <span class=p >{</span>
            <span class=s2 >"max"</span><span class=p >:</span> <span class=mi >10</span><span class=p >,</span>
            <span class=s2 >"min"</span><span class=p >:</span> <span class=mi >1</span><span class=p >,</span>
            <span class=s2 >"default_value"</span><span class=p >:</span> <span class=mi >1</span><span class=p >,</span>
            <span class=s2 >"step"</span><span class=p >:</span> <span class=mi >1</span><span class=p >,</span>
            <span class=s2 >"unit"</span><span class=p >:</span> <span class=s2 >"Hours"</span>
        <span class=p >},</span>
        <span class=s2 >"num_of_task"</span><span class=p >:</span> <span class=p >{</span>
            <span class=s2 >"max"</span><span class=p >:</span> <span class=mi >127</span><span class=p >,</span>
            <span class=s2 >"min"</span><span class=p >:</span> <span class=mi >1</span><span class=p >,</span>
            <span class=s2 >"default_value"</span><span class=p >:</span> <span class=mi >9</span><span class=p >,</span>
            <span class=s2 >"step"</span><span class=p >:</span> <span class=mi >1</span>
        <span class=p >},</span>
        <span class=s2 >"memory_per_cpu"</span><span class=p >:</span> <span class=p >{</span>
            <span class=s2 >"max"</span><span class=p >:</span> <span class=mi >4</span><span class=p >,</span>
            <span class=s2 >"min"</span><span class=p >:</span> <span class=mi >1</span><span class=p >,</span>
            <span class=s2 >"default_value"</span><span class=p >:</span> <span class=mi >1</span><span class=p >,</span>
            <span class=s2 >"step"</span><span class=p >:</span> <span class=mi >1</span><span class=p >,</span>
            <span class=s2 >"unit"</span><span class=p >:</span> <span class=s2 >"GB"</span>
        <span class=p >}</span>
<span class=p >},</span>
</pre></div> </div> <p>An example for <code class="docutils literal notranslate"><span class=pre >stringOptionRule</span></code> is:</p> <div class="highlight-default notranslate"><div class=highlight ><pre><span></span><span class=p >{</span>
    <span class=s2 >"slurm_input_rules"</span><span class=p >:</span> <span class=p >{</span>
        <span class=o >//</span> <span class=o >...</span>
        <span class=s2 >"partition"</span><span class=p >:</span> <span class=p >{</span>
            <span class=s2 >"type"</span><span class=p >:</span> <span class=s2 >"string_option"</span><span class=p >,</span>
            <span class=s2 >"options"</span><span class=p >:</span> <span class=p >[</span><span class=s2 >"option_a"</span><span class=p >,</span> <span class=s2 >"option_b"</span><span class=p >,</span> <span class=s2 >"option_c"</span><span class=p >],</span>
            <span class=s2 >"default_value"</span><span class=p >:</span> <span class=s2 >"option_a"</span>
        <span class=p >}</span>
    <span class=p >}</span>
<span class=p >}</span>
</pre></div> </div> <div class="admonition note"> <p class=admonition-title >Note</p> <p>Please put in a reasonable range for your SLURM parameters. Compute relies on community resources and we must be respectful of other users within the community. Further, note that many end-users of Compute (students, domain experts, etc.) do not understand these parameters. Thus specifying a reasonable default and a narrow range of options is usually the best approach.</p> </div> <h2 id=supported-hpc >Supported HPC<a class=headerlink  href="#supported-hpc" title="Permalink to this headline">¶</a></h2> <p>The default is to only have Keeling (“keeling_community”) supported. We recommend that everyone use Keeling for testing purposes. However, it may not be suitable for all use-cases including very large memory execution and GPU computing. You can view the other community account options using the “cybergis.list_hpc()” command.</p> <p>An example that supports multiple HPC centers is the <a class="reference external" href="https://github.com/cybergis/cybergis-compute-v2-summa/blob/ef3c3bde53e44a85f929a023d2876c8e2e9652de/manifest.json">SUMMA model</a> whose manifest can be viewed below:</p> <div class="highlight-default notranslate"><div class=highlight ><pre><span></span><span class=p >{</span>
    <span class=s2 >"name"</span><span class=p >:</span> <span class=s2 >"SUMMA"</span><span class=p >,</span>
    <span class=s2 >"description"</span><span class=p >:</span> <span class=s2 >"SUMMA or the Structure for Unifying Multiple Modeling Alternatives is a hydrologic modeling approach that is built on a common set of conservation equations and a common numerical solver, which together constitute the structural core of the model. Different modeling approaches can then be implemented within the structural core, enabling a controlled and systematic analysis of alternative modeling options, and providing insight for future model development."</span><span class=p >,</span>
    <span class=s2 >"estimated_runtime"</span><span class=p >:</span> <span class=s2 >"vary by model size, simulation period and configurations"</span><span class=p >,</span>
    <span class=s2 >"container"</span><span class=p >:</span> <span class=s2 >"summa-3.0.3"</span><span class=p >,</span>
    <span class=s2 >"pre_processing_stage"</span><span class=p >:</span> <span class=s2 >"python preprocessing.py"</span><span class=p >,</span>
    <span class=s2 >"execution_stage"</span><span class=p >:</span> <span class=s2 >"python main.py"</span><span class=p >,</span>
    <span class=s2 >"post_processing_stage"</span><span class=p >:</span> <span class=s2 >"python postprocessing.py"</span><span class=p >,</span>
    <span class=s2 >"slurm_input_rules"</span><span class=p >:</span> <span class=p >{</span>

        <span class=s2 >"time"</span><span class=p >:</span> <span class=p >{</span>
                <span class=s2 >"max"</span><span class=p >:</span> <span class=mi >10</span><span class=p >,</span>
                <span class=s2 >"min"</span><span class=p >:</span> <span class=mi >1</span><span class=p >,</span>
                <span class=s2 >"default_value"</span><span class=p >:</span> <span class=mi >1</span><span class=p >,</span>
                <span class=s2 >"step"</span><span class=p >:</span> <span class=mi >1</span><span class=p >,</span>
                <span class=s2 >"unit"</span><span class=p >:</span> <span class=s2 >"Hours"</span>
            <span class=p >},</span>
            <span class=s2 >"num_of_task"</span><span class=p >:</span> <span class=p >{</span>
                <span class=s2 >"max"</span><span class=p >:</span> <span class=mi >127</span><span class=p >,</span>
                <span class=s2 >"min"</span><span class=p >:</span> <span class=mi >1</span><span class=p >,</span>
                <span class=s2 >"default_value"</span><span class=p >:</span> <span class=mi >9</span><span class=p >,</span>
                <span class=s2 >"step"</span><span class=p >:</span> <span class=mi >1</span>
            <span class=p >},</span>
            <span class=s2 >"memory_per_cpu"</span><span class=p >:</span> <span class=p >{</span>
                <span class=s2 >"max"</span><span class=p >:</span> <span class=mi >4</span><span class=p >,</span>
                <span class=s2 >"min"</span><span class=p >:</span> <span class=mi >1</span><span class=p >,</span>
                <span class=s2 >"default_value"</span><span class=p >:</span> <span class=mi >1</span><span class=p >,</span>
                <span class=s2 >"step"</span><span class=p >:</span> <span class=mi >1</span><span class=p >,</span>
                <span class=s2 >"unit"</span><span class=p >:</span> <span class=s2 >"GB"</span>
            <span class=p >}</span>
    <span class=p >},</span>
    <span class=s2 >"require_upload_data"</span><span class=p >:</span> <span class=n >true</span><span class=p >,</span>
    <span class=s2 >"supported_hpc"</span><span class=p >:</span> <span class=p >[</span><span class=s2 >"keeling_community"</span><span class=p >,</span> <span class=s2 >"expanse_community"</span><span class=p >],</span>
    <span class=s2 >"default_hpc"</span><span class=p >:</span> <span class=s2 >"keeling_community"</span>
<span class=p >}</span>
</pre></div> </div> <p>In particular, note the line:</p> <div class="highlight-default notranslate"><div class=highlight ><pre><span></span><span class=s2 >"supported_hpc"</span><span class=p >:</span> <span class=p >[</span><span class=s2 >"keeling_community"</span><span class=p >,</span> <span class=s2 >"expanse_community"</span><span class=p >],</span>
</pre></div> </div> <p>which is simply specifying a list of supported HPCs: Keeling and Expanse. The line:</p> <div class="highlight-default notranslate"><div class=highlight ><pre><span></span><span class=s2 >"default_hpc"</span><span class=p >:</span> <span class=s2 >"keeling_community"</span>
</pre></div> </div> <p>specifies that the HPC “keeling_community” should be the default option in the SDK UI’s dropdown.</p> <h2 id=providing-input-data >Providing Input Data<a class=headerlink  href="#providing-input-data" title="Permalink to this headline">¶</a></h2> <p>You can make users upload data by setting “require_upload_data” to “true”. If this is selected, the user will be asked to upload data before submitting a job. Model developers can also use this mechanism to provide their data to jobs running with CyberGIS-Compute.</p> <p>The path can be accessed by the job by accessing the “data_folder” environment variable (in Python, by using <code class="docutils literal notranslate"><span class=pre >os.environ[“data_folder”]</span></code>). This can be done in the script or in preprocessing/postprocessing. The SUMMA job is an example of a job that requires data upload: <a class="reference external" href="https://github.com/cybergis/cybergis-compute-v2-summa">https://github.com/cybergis/cybergis-compute-v2-summa</a></p> <p>For model contributors who would like to provide all users data, there are a variety of options:</p> <ul class=simple > <li><p><strong>Github:</strong> This is the preferred method although Github has data limits. For data larger than the limits, you could try compressing the data, but if that does not work there are other options.</p> <li><p><strong>Downloading Public Data:</strong> If your data is hosted publically somewhere, this data can be downloaded by the Compute job (for example as part of the pre_processing_stage). There are a variety of tools for accomplishing this including <cite>wget</cite> in bash and <cite>requests</cite> in Python.</p> <li><p><strong>Downloading from Google Drive:</strong> Another option is to host your data on Google Drive. Within CyberGIS-Compute, you can download the data using the Python <a class="reference external" href="https://github.com/wkentaro/gdown">gdown package</a></p> </ul> <h2 id=installing-packages >Installing Packages<a class=headerlink  href="#installing-packages" title="Permalink to this headline">¶</a></h2> <p>We have a library of containers you can draw from, with the most common being “cybergisx-0.4” and “python” which have a variety of standard Python packages. For most use-cases, you simply need to install a handful of packages with Pip or Conda to get your code running.</p> <p>A job that does this is the pysal-access Compute example. This job has a “pre_processing_stage” which runs a simple script to install the Pysal access package with pip (<a class="reference external" href="https://github.com/cybergis/pysal-access-compute-example/blob/7fbbc25d8f2842d8696013e03a31c22e79ccf537/manifest.json#L4">see this line in the manifest</a> which calls the script <a class="reference external" href="https://github.com/cybergis/pysal-access-compute-example/blob/7fbbc25d8f2842d8696013e03a31c22e79ccf537/install_access.sh">install_access.sh</a>). We highly recommend this pattern of installing needed packages in the preprocessing steps when possible instead of using a custom container.</p> <p>For more complex use cases, you can build a Docker or Singularity image which can run your code and we can add the container to our Core. However, we strongly recommend using one of our provided containers whenever possible. See “Providing a Container” for more information.</p> <h2 id=contributing-your-model >Contributing Your Model<a class=headerlink  href="#contributing-your-model" title="Permalink to this headline">¶</a></h2> <p>We are still working on the specific mechanism for having your model added to our deployment of compute. To have your model registered, please contact the CyberGIS-Compute team.</p> <h2 id=advanced-topic-manifest-options >Advanced Topic: Manifest Options<a class=headerlink  href="#advanced-topic-manifest-options" title="Permalink to this headline">¶</a></h2> <p>The manifest has a variety of options and here we will try to give a more comprehensive overview.</p> <p><strong>Metadata:</strong> These describe the model and provide metadata to the user. Examples are:</p> <ul class=simple > <li><p><strong>name:</strong> the name of the model.</p> <li><p><strong>description:</strong> a short textual description of the model.</p> <li><p><strong>estimated_runtime:</strong> a short estimate of the runtime of your model.</p> </ul> <p><strong>How to Run the Model:</strong> These describe how Compute will run the model. Examples are:</p> <ul class=simple > <li><p><strong>container:</strong> The Singularity container in which your job will run.</p> <li><p><strong>pre_processing_stage:</strong> The first stage of your model.</p> <li><p><strong>execution_stage:</strong> The second and main stage of your model.</p> <li><p><strong>post_processing_stage:</strong> The third and final stage of your model.</p> <li><p><strong>slurm_input_rules:</strong> The inputs passed to the SLURM job scheduler when running your job. Most common are time and memory, but we support more complex tasks (i.e. MPI, GPU). For more information, see [“Crash Course in SLURM Parameters” in our Model Contribution guide](<a class="reference external" href="https://cybergis.github.io/cybergis-compute-python-sdk/model_contribution/develop_model.html#crash-course-in-slurm-parameters">https://cybergis.github.io/cybergis-compute-python-sdk/model_contribution/develop_model.html#crash-course-in-slurm-parameters</a>).</p> <li><p><strong>supported_hpc/default_hpc:</strong> CyberGIS-Compute supports a variety of High Performance Computing (HPC) resources and gives users/model contributors the ability to specify which resources their model runs on. For more information, see [“Supported HPC” in our Model Contribution guide](<a class="reference external" href="https://cybergis.github.io/cybergis-compute-python-sdk/model_contribution/develop_model.html#supported-hpc">https://cybergis.github.io/cybergis-compute-python-sdk/model_contribution/develop_model.html#supported-hpc</a>).</p> </ul> <p><strong>How the User Interacts with Your Model:</strong> CyberGIS-Compute provides the flexibility for users to customize jobs by specifying parameters, tweaking SLURM inputs, and uploading data.</p> <ul class=simple > <li><p><strong>param_rules:</strong> This is a section that allows you to define widgets which users will use to pass parameters into the model. For more information, see <a class="reference external" href="https://cybergis.github.io/cybergis-compute-python-sdk/model_contribution/develop_model.html#advanced-topic-passing-parameters">“Advanced Topic: Passing Parameters” in our Model Contribution guide</a>.</p> <li><p><strong>slurm_input_rules:</strong> This information populates widgets allowing users to specify their SLURM settings. For more information, see <a class="reference external" href="https://cybergis.github.io/cybergis-compute-python-sdk/model_contribution/develop_model.html#crash-course-in-slurm-parameters">“Crash Course in SLURM Parameters” in our Model Contribution guide</a>.</p> <li><p><strong>require_upload_data</strong> This allows you to ask users for input data which can be used in your analysis. For more information, see <a class="reference external" href="https://cybergis.github.io/cybergis-compute-python-sdk/model_contribution/develop_model.html#providing-input-data">“Providing Input Data” in our Model Contribution guide</a>.</p> <li><p><strong>default_result_folder_downloadable_path:</strong> This allows you to specify the path within the result folder which will be the default option in the Download Results dropdown.</p> </ul> <h2 id=advanced-topic-passing-parameters >Advanced Topic: Passing Parameters<a class=headerlink  href="#advanced-topic-passing-parameters" title="Permalink to this headline">¶</a></h2> <p>To add basic parameters, add a field in the manifest file called “param_rules”. Define each parameter with the name and rules for model users when they submit their job. For example, adding the field to the left to your manifest.json file will allow the model user to input an integer 0-100 when submitting the job.</p> <p>These parameter choices are added to the environment where your code executes. The value of a parameter “input_a” can be accessed by the script as the environment variable “param_input_a”. For example, in Python this can be done as “os.environ[‘param_input_a’]” The WRFHydro job has params which are used in the compile.sh script: <a class="reference external" href="https://github.com/cybergis/cybergis-compute-v2-wrfhydro">https://github.com/cybergis/cybergis-compute-v2-wrfhydro</a></p> <h2 id=advanced-topic-providing-a-container >Advanced Topic: Providing a Container<a class=headerlink  href="#advanced-topic-providing-a-container" title="Permalink to this headline">¶</a></h2> <p>Our containers are generally built as Docker images and then converted to Singularity containers when used on HPC. We do not currently have a system for contributing containers, but we are working on one. Check back soon!</p> <h2 id=advanced-topic-pre-and-post-steps >Advanced Topic: Pre- and Post- Steps<a class=headerlink  href="#advanced-topic-pre-and-post-steps" title="Permalink to this headline">¶</a></h2> <p>The “execution_stage” is required for every model, however, there are also optional pre- and post-processing stages which can be used. These offer greater flexibility in how your model runs. The stages in detail are:</p> <ol class="arabic simple"> <li><p><strong>pre_processing_stage (string):</strong> an <em>optional</em> bash command that runs when the project begins. Single threaded, non-MPI.</p> <li><p><strong>execution_stage (string):</strong> the <strong>required</strong> bash command that runs in multi-threaded MPI and executes the project. If you’d like to run sbatch command, use <cite>execution_stage_in_raw_sbatch: Array&lt;string&gt;</cite></p> <li><p><strong>post_processing_stage (string):</strong> an <em>optional</em> bash command that runs after execution finishes. Single threaded, non-MPI.</p> </ol> <p>A few examples of how one might use them:</p> <ul class=simple > <li><p>[Pre] Install packages with Pip –&gt; [Main] Run a model in Python</p> <li><p>[Pre] Compile code –&gt; [Main] Run the model –&gt; [Post] Manage/analyze the model outputs</p> </ul> <p>All of these steps are simply commands to run (usually calling a script). Example syntax for the manifest is:</p> <div class="highlight-default notranslate"><div class=highlight ><pre><span></span><span class=s2 >"pre_processing_stage"</span><span class=p >:</span> <span class=s2 >"python preprocessing.py"</span><span class=p >,</span>
<span class=s2 >"execution_stage"</span><span class=p >:</span> <span class=s2 >"python main.py"</span><span class=p >,</span>
<span class=s2 >"post_processing_stage"</span><span class=p >:</span> <span class=s2 >"python postprocessing.py"</span><span class=p >,</span>
</pre></div> </div> </article> </div> </div> </main> </div> <footer class=md-footer > <div class=md-footer-nav > <nav class="md-footer-nav__inner md-grid"> <a href=index.html  title="Contributing Models" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev > <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis > <span class=md-footer-nav__direction > "Previous" </span> Contributing Models </span> </div> </a> <a href=faq.html  title="Frequently Asked Questions" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next > <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span class=md-flex__ellipsis > <span class=md-footer-nav__direction > "Next" </span> Frequently Asked Questions </span> </div> <div class="md-flex__cell md-flex__cell--shrink"><i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright > <div class=md-footer-copyright__highlight > &#169; Copyright 2022, CyberGIS Center. </div> Created using <a href="http://www.sphinx-doc.org/">Sphinx</a> 2.4.4. and <a href="https://github.com/bashtage/sphinx-material/">Material for Sphinx</a> </div> </div> </div> </footer> <script src="../_static/javascripts/application.js"></script> <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>